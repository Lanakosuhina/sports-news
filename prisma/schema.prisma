generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String
  role          Role      @default(EDITOR)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  articles      Article[]
}

enum Role {
  ADMIN
  EDITOR
}

model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  slug        String    @unique
  description String?
  icon        String?
  order       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  articles    Article[]
  leagues     League[]
}

model League {
  id         String    @id @default(cuid())
  name       String
  slug       String    @unique
  country    String?
  logo       String?
  categoryId String
  category   Category  @relation(fields: [categoryId], references: [id])
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  articles   Article[]
  matches    Match[]
  standings  Standing[]
}

model Tag {
  id        String    @id @default(cuid())
  name      String    @unique
  slug      String    @unique
  createdAt DateTime  @default(now())
  articles  Article[]
}

model Article {
  id              String        @id @default(cuid())
  title           String
  slug            String        @unique
  excerpt         String
  content         String
  featuredImage   String?
  gallery         String[]
  videoUrl        String?
  status          ArticleStatus @default(DRAFT)
  views           Int           @default(0)
  publishedAt     DateTime?
  metaTitle       String?
  metaDescription String?
  canonicalUrl    String?
  authorId        String?
  author          User?         @relation(fields: [authorId], references: [id])
  categoryId      String
  category        Category      @relation(fields: [categoryId], references: [id])
  leagueId        String?
  league          League?       @relation(fields: [leagueId], references: [id])
  tags            Tag[]
  matchId         String?       @unique
  match           Match?        @relation(fields: [matchId], references: [id])
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([status, publishedAt])
  @@index([categoryId])
  @@index([leagueId])
}

enum ArticleStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
}

model Team {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  shortName   String?
  logo        String?
  country     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  homeMatches Match[]  @relation("HomeTeam")
  awayMatches Match[]  @relation("AwayTeam")
  standings   Standing[]
}

model Match {
  id           String      @id @default(cuid())
  homeTeamId   String
  homeTeam     Team        @relation("HomeTeam", fields: [homeTeamId], references: [id])
  awayTeamId   String
  awayTeam     Team        @relation("AwayTeam", fields: [awayTeamId], references: [id])
  homeScore    Int?
  awayScore    Int?
  leagueId     String
  league       League      @relation(fields: [leagueId], references: [id])
  matchDate    DateTime
  status       MatchStatus @default(SCHEDULED)
  venue        String?
  article      Article?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  @@index([matchDate])
  @@index([leagueId])
}

enum MatchStatus {
  SCHEDULED
  LIVE
  FINISHED
  POSTPONED
  CANCELLED
}

model Standing {
  id           String   @id @default(cuid())
  teamId       String
  team         Team     @relation(fields: [teamId], references: [id])
  leagueId     String
  league       League   @relation(fields: [leagueId], references: [id])
  position     Int
  played       Int      @default(0)
  won          Int      @default(0)
  drawn        Int      @default(0)
  lost         Int      @default(0)
  goalsFor     Int      @default(0)
  goalsAgainst Int      @default(0)
  points       Int      @default(0)
  season       String
  updatedAt    DateTime @updatedAt

  @@unique([teamId, leagueId, season])
  @@index([leagueId, season])
}

model AdZone {
  id               String   @id @default(cuid())
  name             String   @unique
  slug             String   @unique
  placement        String   @default("sidebar-top") // sidebar-top, sidebar-bottom, article-top, article-bottom, header, footer
  size             String   @default("medium-rectangle") // medium-rectangle, half-page, leaderboard, etc.
  imageUrl         String?
  linkUrl          String?
  code             String?  // For external ad code (Google Ads, etc.)
  isActive         Boolean  @default(true)
  order            Int      @default(0)
  startDate        DateTime?
  endDate          DateTime?
  impressions      Int      @default(0)
  clicks           Int      @default(0)
  rotationGroup    String?  // Group name for rotation - ads with same group rotate
  rotationInterval Int      @default(0) // Rotation interval in seconds (0 = no rotation)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([placement, isActive])
  @@index([rotationGroup])
}

model Page {
  id              String   @id @default(cuid())
  title           String
  slug            String   @unique
  content         String
  metaTitle       String?
  metaDescription String?
  isPublished     Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model SiteSettings {
  id              String   @id @default(cuid())
  siteName        String   @default("Sports News")
  siteDescription String?
  logo            String?
  favicon         String?
  socialFacebook  String?
  socialTwitter   String?
  socialInstagram String?
  socialYoutube   String?
  analyticsCode   String?
  updatedAt       DateTime @updatedAt
}

// Security Models

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  userEmail  String?
  action     String   // CREATE, UPDATE, DELETE, LOGIN, LOGOUT
  entityType String?  // Article, User, Category, etc.
  entityId   String?
  details    Json?    // Additional context
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

model LoginAttempt {
  id        String   @id @default(cuid())
  email     String
  success   Boolean
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())

  @@index([email, createdAt])
  @@index([ipAddress, createdAt])
}

// Bookmakers

model Bookmaker {
  id             String   @id @default(cuid())
  name           String   @unique
  slug           String   @unique
  logo           String?
  description    String?  // Rich text description
  bonus          String?  // e.g., "10000 ₽"
  bonusLabel     String?  // e.g., "Эксклюзив", "Новым игрокам"
  reviewsCount   Int      @default(0)
  playersCount   Int      @default(0)
  rating         Float    @default(0)
  link           String   // Play button URL
  website        String?  // e.g., "winline.ru"
  hasLicense     Boolean  @default(true)
  licenseNumber  String?  // e.g., "ФНС №12345"
  minDeposit     String?  // e.g., "500 ₽"
  hasIosApp      Boolean  @default(true)
  hasAndroidApp  Boolean  @default(true)
  iosAppLink     String?
  androidAppLink String?
  isActive       Boolean  @default(true)
  order          Int      @default(0)
  ratingOrder    Int      @default(0)
  customFields   Json?    // Flexible key-value pairs for extensible data

  // Promo card fields for bonus pages
  promoImage          String?  // Background image for promo card
  promoTitle          String?  // e.g., "ФРИБЕТЫ ДО 15 000₽"
  promoDescription    String?  // Description text
  promoCode           String?  // Promocode to copy
  promoExpiry         DateTime? // Expiry date (null = бессрочно)
  promoLabel          String?  // e.g., "Без депозита"
  showOnFribet        Boolean  @default(false)
  showOnBezDepozita   Boolean  @default(false)
  showOnPromokodWinline   Boolean  @default(false)
  showOnPromokodyFonbet   Boolean  @default(false)

  // Bookmaker page enhancements
  headerBackgroundImage String?  // Background for header card
  mobileAppImage        String?  // Banner image in mobile app block
  textBlocks            Json?    // Array of text blocks [{title, content}]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Selection {
  id        String   @id @default(cuid())
  name      String   @unique
  slug      String   @unique
  icon      String?  // Icon name from lucide-react
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
